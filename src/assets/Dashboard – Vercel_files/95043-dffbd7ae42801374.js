"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[95043],{966829:function(e,t,n){n.d(t,{D:function(){return u}});var r=n(3048),o=n(595376),i=n(52954),l=n(843987);async function u(e,t){var n;let{mode:u}=t,a=o.daumtools.userAgent(),c=null==a?void 0:null===(n=a.browser)||void 0===n?void 0:n.name,s=`Website${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,g=r.stringify({mode:u});return(0,i.I)(`${l.OK}?${g}`,{method:"POST",body:JSON.stringify({email:e,tokenName:s}),throwOnHTTPError:!0})}},366210:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(3048),o=n(52954),i=n(958477),l=n(843987);async function u(e){let{email:t,token:n,ssoToken:u}=e,a=r.stringify({email:t,token:n,t:Date.now(),...u&&{ssoToken:u}});try{return await (0,o.I)(`${l.OK}/verify?${a}`,{throwOnHTTPError:!0}),delete globalThis.__loggedIn,!0}catch(e){if((0,i.f)(e)&&403===e.status)throw e;return!1}}},958477:function(e,t,n){n.d(t,{f:function(){return o}});var r=n(939373);let o=e=>(0,r.x)(e)&&"code"in e},294609:function(e,t,n){n.d(t,{E:function(){return i}});var r=n(879756),o=n.n(r);async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return o()(e,{randomize:!1,factor:1,minTimeout:t>=5?1e3:250,maxTimeout:t>=5?1001:251,retries:t})}},161123:function(e,t,n){n.d(t,{Z:function(){return r}});function r(e){return new Promise(t=>{setTimeout(t,e)})}},495043:function(e,t,n){n.d(t,{YN:function(){return y},PM:function(){return b},aC:function(){return k}});var r=n(312253),o=n(187968),i=n(151854),l=n(560630),u=n.n(l),a=n(490720),c=n.n(a),s=n(348631),g=n(966829),d=n(366210),f=n(161123),h=n(364112),p=n(190594),E=n(694620),S=n(293153),I=n(925407),O=n(294609),A=n(843987),L=n(157966),v=n(958477),R=n(32225),N=n(315573),m=n(52954);let b={PLACEHOLDER:"placeholder",INPUT:"input",LOADING_EMAIL:"loading-email",LOADING_GITHUB:"loading-github",LOADING_GITLAB:"loading-gitlab",LOADING_BITBUCKET:"loading-bitbucket",LOADING_SAML:"loading-saml",VERIFYING_EMAIL:"verifying",SUCCESS:"success",ERROR:"error",ACCOUNT_NEEDS_VERIFY_SMS:"account-needs-verify"},y=[b.LOADING_GITHUB,b.LOADING_GITLAB,b.LOADING_BITBUCKET,b.LOADING_SAML,b.LOADING_EMAIL];function C(e,t){return{...e,...t}}let T=()=>{},_=()=>`${window.location.origin}/oauth/git`,k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"login",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[n,a]=(0,r.useReducer)(C,{loginState:b.PLACEHOLDER,loginError:null,isLoading:!0,...t.defaultState}),k=(0,r.useRef)(null),G=(0,l.useRouter)(),{query:D,isReady:U}=G,P=(0,h.Z)(G.query.next),$=(0,r.useRef)(T),x=(0,r.useRef)(t);x.current=t,(0,r.useEffect)(()=>()=>{k.current&&k.current.close(),k.current=null},[]),(0,r.useEffect)(()=>{let e=n.loginState===b.PLACEHOLDER||y.includes(n.loginState);n.isLoading&&!e&&a({isLoading:e})},[n.loginState,n.isLoading]),(0,r.useEffect)(()=>{if(u().query.next&&!(0,h.Z)(u().query.next)){let{pathname:e,query:t}=u();delete t.next,u().replace({pathname:e,query:t},void 0,{shallow:!0})}},[]),(0,r.useEffect)(()=>{if(!k.current&&U){if("saml"===D.loginType&&"1"===D.confirmed){a({loginState:b.LOADING_SAML});let e=_()+(0,E.c)({next:D.teamSlug?`/${D.teamSlug}`:void 0,...D});u().push(e);return}if("saml"===D.origin&&"/login"===location.pathname){a({loginState:b.LOADING_SAML}),u().push(`/teams/connect${(0,E.c)(D)}`);return}a({loginState:b.INPUT})}},[D,U]),(0,r.useEffect)(()=>{let e=(0,N.P)(D.loginError);e&&a({loginState:b.ERROR,loginError:(0,L.j)(e)})},[D.loginError]);let M=(0,r.useCallback)(async r=>{var o,i,l,c,g;if(!k.current||r.source!==k.current.popup||"object"!=typeof r.data||!r.data)return;let{source:d,close:f,success:h,next:p,...E}=r.data;if("vercel-verify-auth"!==d)return;let S=null===(o=k.current)||void 0===o?void 0:null===(i=o.popup)||void 0===i?void 0:i.location.search,O=S?new URLSearchParams(S):null;if(f){k.current.close(!0),k.current=null,O&&O.has("origin")&&"saml"===O.get("origin")&&u().push(`/teams/connect?${O.toString()}`);return}if(E.loginError&&(k.current.close(!0),k.current=null),a(E),h){let r=O?O.get("next"):null,o=r?decodeURIComponent(r):null;if(null===(l=k.current)||void 0===l||l.close(!0),k.current=null,"signup"===e)try{s.co.track(s.s6.CREATE_ACCOUNT),s.co.track(s.s6.SIGN_UP)}catch(e){}else if("login"===e)try{s.co.track(s.s6.LOGIN)}catch(e){}if(delete globalThis.__loggedIn,x.current.onAuthenticated)x.current.onAuthenticated();else{let r=p||o||P||"signup"!==e&&"/dashboard";if(r){if("signup"===e&&r.startsWith("/turborepo"))try{let e=await (0,R.P)();e.user&&await w(e.user.email)}catch(e){console.error(e)}t.skipDefaultRedirectOnSignup||(location.href=r)}else["loading-github","loading-gitlab","loading-bitbucket"].includes(n.loginState)&&await (0,I.x)({provider:n.loginState.split("-")[1],namespaceId:null}),location.href="/new"}}else null===(g=(c=x.current).onError)||void 0===g||g.call(c)},[e,P,t.skipDefaultRedirectOnSignup,n.loginState]);function B(n,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{next:i,callbackParams:l,...u}=o,c=_()+(0,E.c)({next:t.useRedirect?i??P:i,...l});"login"===e?s.co.track(s.s6.LOGIN,{source:`${(0,S.F)(n)} login`}):s.co.track(s.s6.SIGN_UP);let g="saml"===n.toLowerCase()?A.fr:A.OK,d=`${g}${r}${(0,E.c)({mode:e,next:c,...u})}`;a({loginError:null}),t.useRedirect?(a({loginState:b[`LOADING_${n.toUpperCase()}`]}),location.href=d):(k.current=new p.Z({id:"vercel-login-popup",url:d,callbacks:{onOpen:()=>{a({loginState:b[`LOADING_${n.toUpperCase()}`]})},onAbort:()=>{k.current=null,a({loginState:b.INPUT})},onClose:()=>{k.current=null,a({loginState:b.INPUT})},onBlocked:()=>{k.current=null,a({loginState:b.ERROR,loginError:{code:null,message:`The popup to authenticate with ${(0,S.F)(n)} could not be opened.`}})}}}),k.current.open())}function H(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};B(e,"github"===e?"/login-with-github":`/${e}/connect`,t)}return(0,r.useEffect)(()=>(window.addEventListener("message",M),()=>{window.removeEventListener("message",M)}),[M]),{saveInput:function(e,t){n.loginState===b.ERROR?a({[e]:t,loginError:null}):a({[e]:t})},cancelLogin:function(){if($.current(),a({loginState:b.INPUT,loginError:null}),t.skipRouterRedirectOnCancel)return;let{pathname:e,query:{next:n,isRequestAccess:r,teamName:o}}=G,i=function(e){let t={...e};for(let e of Object.keys(t))void 0===t[e]&&delete t[e];return t}({next:n,isRequestAccess:r,teamName:o});G.replace({pathname:e,query:i})},loginWithEmail:async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{email:l}=n,u=!1;$.current(),$.current=()=>u=!0;try{a({loginState:b.LOADING_EMAIL,loginError:null});let n=await (0,g.D)(l,{mode:e});a({loginState:b.VERIFYING_EMAIL,email:l,securityCode:n.securityCode});for(;;){var h;if(u)return;if(await (0,d.Z)({email:l,token:n.token,ssoToken:null===(h=r.callbackParams)||void 0===h?void 0:h.ssoToken}))break;await (0,f.Z)(2500)}if("signup"===e)try{s.co.track(s.s6.CREATE_ACCOUNT),s.co.track(s.s6.SIGN_UP)}catch(e){}else if("login"===e)try{s.co.track(s.s6.LOGIN)}catch(e){}let o=r.patchedSignupAccountName;"signup"===e&&o&&o.length>0&&await (0,O.E)(()=>(0,m.I)(A.zh,{method:"PATCH",body:{name:c()(o)}}));let i=r.next||P;if(i){if("signup"===e&&i.startsWith("/turborepo")&&l)try{await w(l)}catch(e){console.error(e)}"signup"===e&&t.skipDefaultRedirectOnSignup?a({loginState:b.SUCCESS}):location.href=i;return}if("signup"===e&&!t.skipDefaultRedirectOnSignup){location.href="/new?onboarding=true";return}a({loginState:b.SUCCESS})}catch(e){if(u)return;(0,v.f)(e)&&(e.redirect||(null==e?void 0:e.code)===o.aU.ACCOUNT_NEEDS_VERIFY)?n.email&&a({loginState:b.ACCOUNT_NEEDS_VERIFY_SMS}):a({loginState:b.ERROR,loginError:(0,i.SC)(e)})}},loginWithSAML:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{teamSlug:r}=n;if(!r)return a({loginState:b.ERROR,loginError:{code:"",message:"Please enter a Team slug."}});B("saml","",{next:P||`/${r}`,...t,teamId:r,mode:e})},loginWithGitHub:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return H("github",e)},loginWithGitLab:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return H("gitlab",e)},loginWithBitbucket:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return H("bitbucket",e)},loginWithGit:H,state:n,dispatch:a,mode:e}};async function w(e){try{let t=await fetch("/api/turborepo-signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw Error("An unexpected error. Please try again later.")}catch(e){console.error(e)}}}}]);